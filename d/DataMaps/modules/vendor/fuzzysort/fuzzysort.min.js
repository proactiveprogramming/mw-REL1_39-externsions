// https://github.com/farzher/fuzzysort v2.0.4
"use strict";var go=(r,e,a)=>{var t=getPreparedSearch(r),n=t.t,p=a.threshold||INT_MIN,o=0;if(a.weighedKey){var i,l=a.scoreFn||defaultScoreFn;for(i of e){for(var f=i[a.weighedKey],c=new Array(f.length),s=0;s<f.length;++s){var u=f[s],v=u[0];v?((n&(v=isObj(v)?v:getPrepared(v)).p)!==n?c[s]=null:c[s]=algorithm(t,v),c[s]&&(c[s].score/=u[1])):c[s]=null}c.obj=i;var h=l(c);null===h||h<p||(c.score=h,q.add(c),++o)}}if(0===o)return noResults;for(var S=new Array(o),g=o-1;0<=g;--g)S[g]=q.o();return S.total=o,S},prepare=r=>{var e=prepareLowerInfo(r="string"!=typeof r?"":r);return{target:r,i:e.l,u:e.v,h:null,p:e.t,score:null,S:[0],obj:null}},prepareSearch=r=>{r=(r="string"!=typeof r?"":r).trim();var e=prepareLowerInfo(r),a=[];if(e.g)for(var t,n=r.split(/\s+/),n=[...new Set(n)],p=0;p<n.length;p++)""!==n[p]&&(t=prepareLowerInfo(n[p]),a.push({v:t.v,l:n[p].toLowerCase(),g:!1}));return{v:e.v,t:e.t,g:e.g,l:e.l,m:a}},getPrepared=r=>{var e;return 999<r.length?prepare(r):(void 0===(e=preparedCache.get(r))&&(e=prepare(r),preparedCache.set(r,e)),e)},getPreparedSearch=r=>{var e;return 999<r.length?prepareSearch(r):(void 0===(e=preparedSearchCache.get(r))&&(e=prepareSearch(r),preparedSearchCache.set(r,e)),e)},algorithm=(r,e,a=!1)=>{if(!1===a&&r.g)return algorithmSpaces(r,e);for(var a=r.l,t=r.v,n=t[0],p=e.u,o=t.length,i=p.length,l=0,f=0,c=0;;){if(n===p[f]){if(matchesSimple[c++]=f,++l===o)break;n=t[l]}if(i<=++f)return null}var l=0,s=!1,u=0,v=e.h;null===v&&(v=e.h=prepareNextBeginningIndexes(e.target));var h=0;if((f=0===matchesSimple[0]?0:v[matchesSimple[0]-1])!==i)for(;;)if(i<=f){if(l<=0)break;if(200<++h)break;--l,f=v[matchesStrict[--u]]}else if(t[l]===p[f]){if(matchesStrict[u++]=f,++l===o){s=!0;break}++f}else f=v[f];var S=e.i.indexOf(a,matchesSimple[0]),r=~S;if(r&&!s)for(var g=0;g<c;++g)matchesSimple[g]=S+g;a=!1;r&&(a=e.h[S-1]===S);m=s?(d=matchesStrict,u):(d=matchesSimple,c);for(var d,m,I=0,w=0,g=1;g<o;++g)d[g]-d[g-1]!=1&&(I-=d[g],++w);if(I-=(12+(d[o-1]-d[0]-(o-1)))*w,0!==d[0]&&(I-=d[0]*d[0]*.2),s){for(var _=1,g=v[0];g<i;g=v[g])++_;24<_&&(I*=10*(_-24))}else I*=1e3;r&&(I/=1+o*o*1),a&&(I/=1+o*o*1),e.score=I-=i-o;for(g=0;g<m;++g)e.S[g]=d[g];return e.S.I=m,e},algorithmSpaces=(r,e)=>{for(var a=new Set,t=0,n=null,p=0,o=r.m,i=0;i<o.length;++i){var l=o[i];if(null===(n=algorithm(l,e)))return null;t+=n.score,n.S[0]<p&&(t-=p-n.S[0]);for(var p=n.S[0],f=0;f<n.S.I;++f)a.add(n.S[f])}r=algorithm(r,e,!0);if(r!==NULL&&r.score>t)return r;n.score=t;var c,i=0;for(c of a)n.S[i++]=c;return n.S.I=i,n},prepareLowerInfo=r=>{for(var e=r.length,a=r.toLowerCase(),t=[],n=0,p=!1,o=0;o<e;++o){var i=t[o]=a.charCodeAt(o);32===i?p=!0:n|=1<<(97<=i&&i<=122?i-97:48<=i&&i<=57?26:i<=127?30:31)}return{v:t,t:n,g:p,l:a}},prepareBeginningIndexes=r=>{for(var e=r.length,a=[],t=0,n=!1,p=!1,o=0;o<e;++o){var i=r.charCodeAt(o),l=65<=i&&i<=90,i=l||97<=i&&i<=122||48<=i&&i<=57,f=l&&!n||!p||!i,n=l,p=i;f&&(a[t++]=o)}return a},prepareNextBeginningIndexes=r=>{for(var e=r.length,a=prepareBeginningIndexes(r),t=[],n=a[0],p=0,o=0;o<e;++o)o<n?t[o]=n:(n=a[++p],t[o]=void 0===n?e:n);return t},cleanup=()=>{preparedCache.clear(),preparedSearchCache.clear(),matchesSimple=[],matchesStrict=[]},preparedCache=new Map,preparedSearchCache=new Map,matchesSimple=[],matchesStrict=[],defaultScoreFn=r=>{for(var e=INT_MIN,a=r.length,t=0;t<a;++t){var n=r[t];null!==n&&e<(n=n.score)&&(e=n)}return e===INT_MIN?null:e},isObj=r=>"object"==typeof r,INT_MAX=1/0,INT_MIN=-INT_MAX,noResults=[],fastpriorityqueue=(noResults.total=0,r=>{var o=[],i=0,e={},a=r=>{for(var e=o[n=0],a=1;a<i;){var t=a+1,n=a;t<i&&o[t].score<o[a].score&&(n=t),o[n-1>>1]=o[n],a=1+(n<<1)}for(var p=n-1>>1;0<n&&e.score<o[p].score;p=(n=p)-1>>1)o[n]=o[p];o[n]=e};return e.add=r=>{var e=i;o[i++]=r;for(var a=e-1>>1;0<e&&r.score<o[a].score;a=(e=a)-1>>1)o[e]=o[a];o[e]=r},e.o=r=>{var e;if(0!==i)return e=o[0],o[0]=o[--i],a(),e},e._=r=>{if(0!==i)return o[0]},e.N=r=>{o[0]=r,a()},e}),q=fastpriorityqueue();module.exports={go:go,prepare:prepare,cleanup:cleanup};